<div class="container">
  <div class="controls-container">
    <mat-card class="controls">
      <mat-card-content>
        <div class="list"
             [class.no-data]="!puzzle?.observables.length"
             id="observable-list"
             cdkDropList
             [cdkDropListData]="puzzle?.observables"
             [cdkDropListConnectedTo]="getAllIds()"
             [cdkDropListEnterPredicate]="enterPredicateOnlyObservables"
             (cdkDropListDropped)="dropToObservablesSrc($event)">
          <rxp-observable cdkDrag
                          [cdkDragData]="observable"
                          (dblclick)="dblClickObservablesSrc($event, index);"
                          *ngFor="let observable of puzzle?.observables; let index = index;">
            {{observable.title}}
          </rxp-observable>
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card class="controls">
      <div class="list"
           [class.no-data]="!puzzle?.operatorsCollection.length"
           id="operator-list"
           cdkDropList
           [cdkDropListData]="puzzle?.operatorsCollection"
           [cdkDropListConnectedTo]="destOperators"
           (cdkDropListDropped)="dropToOperatorsSrc($event)">
        <rxp-operator cdkDrag
                      [cdkDragData]="operator"
                      (dblclick)="dblClickOperatorsSrc($event, index);"
                      *ngFor="let operator of puzzle?.operatorsCollection; let index = index;">
          {{operator.title}}
        </rxp-operator>
      </div>
    </mat-card>
    <mat-card class="controls">
      <div class="list arguments"
           [class.no-data]="!puzzle?.args.length"
           id="src-arguments"
           cdkDropList
           [cdkDropListData]="puzzle?.args"
           [cdkDropListConnectedTo]="getAllIds()"
           [cdkDropListEnterPredicate]="enterPredicateOnlyArguments"
           (cdkDropListDropped)="dropToArgsSrc($event)">
        <rxp-arg cdkDrag
                 [cdkDragData]="arg"
                 (dblclick)="dblClickArgsSrc($event, index);"
                 *ngFor="let arg of puzzle?.args; let index = index;">
          {{arg.title}}
        </rxp-arg>
      </div>
    </mat-card>
  </div>
  <div class="main-container">
    <div class="main-stream-container">
      <div class="stream" [class.no-stream]="!tree.observable.length">
        <div class="observable-container"
             #destObservables="cdkDropList"
             id="dest-observable"
             cdkDropList
             [cdkDropListData]="tree.observable"
             [cdkDropListConnectedTo]="getAllIds()"
             [cdkDropListEnterPredicate]="enterPredicateOnlyObservables"
             (cdkDropListDropped)="dropObservableToDest($event)">
          <rxp-observable cdkDrag
                          [cdkDragData]="observable"
                          (dblclick)="dblClickObservableDest($event, tree.observable, index);"
                          *ngFor="let observable of tree.observable; let index = index;">
            {{observable.title}}
          </rxp-observable>
        </div>
        <div class="operators-container"
             #destOperators="cdkDropList"
             cdkDropList
             [cdkDropListConnectedTo]="'operator-list'"
             [cdkDropListData]="tree.operators"
             (cdkDropListDropped)="dropOperatorToDest($event)">

          <rxp-operator [inner]="true"
                        [operator]="operator"
                        cdkDrag
                        [cdkDragData]="operator"
                        (dblclick)="dblClickDestOperator($event, tree.operators, index);"
                        *ngFor="let operator of tree.operators; let index = index;">
            <span>{{operator.left}}</span>
            <span class="value-container"
                  [id]="'dest-argument-' + operator.id"
                  cdkDropList
                  [cdkDropListData]="operator.values"
                  [cdkDropListOrientation]="'horizontal'"
                  [cdkDropListConnectedTo]="getAllIds()"
                  (cdkDropListDropped)="dropArgToDest($event)">
              <ng-container *ngFor="let arg of operator.values; let index = index;">
                <rxp-observable [inner]="true"
                                cdkDrag
                                [cdkDragData]="arg"
                                (dblclick)="dblClickObservableDest($event, operator.values, index);"
                                *ngIf="arg.type === 'observable'">
                  {{arg.title}}
                </rxp-observable>
                <rxp-arg [inner]="true"
                         cdkDrag
                         [cdkDragData]="arg"
                         (dblclick)="dblClickDestArg($event, operator.values, index);"
                         *ngIf="arg.type === 'argument'">
                {{arg.title}}
              </rxp-arg>
              </ng-container>
            </span>
            <span>{{operator.right}}</span>
          </rxp-operator>
        </div>
      </div>
    </div>

    <rxp-results [source]="source$" [result]="puzzle?.result"></rxp-results>
  </div>
</div>
